<!-- app/views/things.html start -->
<form ng-submit="newThing()" name="thingInput">
    <input
      type="search"
      ng-model="thingTitle"
      placeholder=" Enter your thing here">
</form>

<!-- div for tags/number lists -->
<div ng-if="filterActive" layout="row">
<!-- FIXME: right-align projects, center I/U -->
    <div flex="25" tag-list ng-controller="TagListController as cl" type="context" all="true" data="contexts" active="contexts"></div>
    <div flex="25" id="importance-list" number-list ng-controller="NumberListController as il" type="importance" all="true" data="importance" active="importance" multiple="true"></div>
    <div flex="25" id="urgency-list" number-list ng-controller="NumberListController as ul" type="urgency" all="true" data="urgency" active="urgency" multiple="true"></div>
    <div flex="25" tag-list ng-controller="TagListController as pl" type="project" all="true" data="projects" active="projects"></div>

</div>

<div>
  <span>
    <div class="search" ng-if="filterActive">
      <input type="text" class="form-control" placeholder="Search"
             ng-model="search.title">
    </div>
  </span>

  <!-- div for by due date filter -->
  <div class="btn-group due-dropdown" ng-if="filterActive" dropdown ng-class="{open: dueOpen}">

    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" ng-click="dueOpen=!dueOpen">
      By Due date: {{ dueSelect }}
      <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
      <li ng-class="{ active: dueSelect == 'all' }">
        <a href="" ng-click="setDueSelect('all')">All</a></li>
      <li ng-class="{ active: dueSelect == 'overdue' }">
        <a href="" ng-click="setDueSelect('overdue')">Overdue</a></li>
      <li ng-class="{ active: dueSelect == 'today' }">
        <a href="" ng-click="setDueSelect('today')">Due Today</a></li>
      <li ng-class="{ active: dueSelect == 'due' }">
        <a href="" ng-click="setDueSelect('due')">Due</a></li>
      <li ng-class="{ active: dueSelect == 'no' }">
        <a href="" ng-click="setDueSelect('no')">No Due Date</a></li>
    </ul>

  </div>

  <!-- span for sort options; pull sort options to the right -->
  <span id="sort-options" ng-if="sortActive" class="pull-right">
    <span id="importance-order" order ng-controller="OrderController as io" type="importance" label="I"></span>
    <span id="urgency-order" order ng-controller="OrderController as uo" type="urgency" label="U"></span>
    <span id="title-order" order ng-controller="OrderController as to" type="title" label="Title"></span>
    <span id="due-order" order ng-controller="OrderController as do" type="due" label="Due"></span>
  </span>
</div>

<!-- FIXME: this table's ng-repeat is in our controller's scope; the one
            inside bp-table below isn't, so that thingsFound is not
            available in ThingsController -->
<table>
<tr ng-repeat="thing in thingsFiltered = (things | filter:notRecentlyCompleted | filter:filterByTag | filter:filterByNumber | filter:search | filter:filterByDueSelector | orderBy:predicate) track by thing.id">
<tr ng-repeat="thing in thingsFound = (things | filter:notRecentlyCompleted | filter:filterByTag | filter:filterByNumber | filter:search | filter:filterByDueSelector | orderBy:predicate | limitTo: 50) track by thing.id">
<td> </td>
</tr>
</table>

<md-content>
<md-list
  ng-if="things.length"
  class="things">

  <!-- bp-table-header is part of the table and scrolls away
       but thingsFound's scope is limited -->
       <md-subheader>
    showing {{ thingsFound.length }} of filtered {{ thingsFiltered.length }} out of a total of {{ things.length }} things
       </md-subheader>


  <md-list-item
    class="md-3-line"
    ng-repeat="thing in thingsFound = (things | filter:notRecentlyCompleted | filter:filterByTag | filter:filterByNumber | filter:search | filter:filterByDueSelector | orderBy:predicate | limitTo: 50) track by thing.id"
    swipe-right="convertToArchive(thing)"
    swipe-left="convertToMit(thing)"
    swipe-long-right="setDeleted(thing)"
    swipe-long-left="setDone(thing)">
      <div class="select">
        <i class="glyphicon" ng-class="{ 'glyphicon-unchecked': !isSelected(thing), 'glyphicon-check': isSelected(thing), 'unchecked': !isSelected(thing) }" ng-click="toggleSelected(thing);"> </i>
      </div>
      <!-- show a complete action; recurring for recurrence things,
           ok-circle to complete normal things -->
      <div class="complete">
        <span ng-if="thing.recurrence" ng-class="{ 'repeat-fade': completed }" class="repeat">
          <i class="glyphicon glyphicon-repeat" ng-click="setComplete(thing); completed = !completed;"></i>
        </span>
        <span ng-if="!thing.recurrence">
          <i class="glyphicon glyphicon-ok-circle" ng-class="{ true: 'unchecked' }[thing.complete != 100]" ng-click="setComplete(thing)"></i>
        </span>
      </div>
    <div class="md-list-item-text">
      <h3 class="title" ui-sref="thingsThing({id:thing.id})">
        {{ thing.title }}
      </h3>
      <h4>
      <div class="recurrence"><span ng-if="thing.recurrence">every {{ thing.recurrence | duration }}</span></div>

      <time ng-if="thing.end" datetime="{{ thing.end | date : 'yyyy-MM-dd' }}">done {{ thing.end | date : 'MMM d yyyy' }}</time>
      <time ng-if="thing.due && !thing.end" datetime="{{ thing.due | date : 'yyyy-MM-dd' : 'UTC' }}">due {{ thing.due | date:'MMM d yyyy':'UTC' }}</time>

      <div class="description" ng-if="thing.description">{{ thing.description }}</div>

      <md-grid-list md-cols-md="4" md-cols-gt-md="4" md-row-height-gt-md="1" md-row-height="2:2"
        md-gutter="1px" md-gutter-gt-sm="1px">
      <md-grid-tile>
      <div class="contexts">
        <b ng-if="thing.contexts" ng-repeat="context in thing.contexts">@{{context}}{{$last ? '' : ', '}}</b>
      </div>
      </md-grid-tile>
      <md-grid-tile>
      <div class="importance" ng-if="thing.importance">
        I:{{thing.importance}}
      </div>
      </md-grid-tile>
      <md-grid-tile>
      <div class="urgency" ng-if="thing.urgency">
        U:{{thing.urgency}}
      </div>
      </md-grid-tile>
      <md-grid-tile>
      <div class="projects">
        <b ng-if="thing.projects" ng-repeat="project in thing.projects">p:{{project}}{{$last ? '' : ', '}}</b>
      </div>
      </md-grid-tile>
      </md-grid-list>
    </div>
      </h4>
    <md-divider inset></md-divider>
  </md-list-item>
</md-list>
</md-content>

<form ng-if="saveListActive" ng-submit="saveList(thingList); saveListActive = false;" name="listInput">
    <input
      ng-model="thingList"
      placeholder=" Enter your list name here">
</form>

<!-- can't get glyphicons to work here
<bp-toolbar>
  <bp-action ng-click="saveListActive = !saveListActive" class="glyphicon glyphicon-list">  </bp-action>
  <bp-action ng-click="filterActive = !filterActive" class="glyphicon glyphicon-filter">  </bp-action>
</bp-toolbar>
-->

<div class="btn-group btn-group-toolbar btn-group-lg">
  <md-button class="md-raised md-primary" ng-click="saveListActive = !saveListActive">save</md-button>
  <md-button type="md-button" ng-click="toggleFilterActive()" class="md-raised md-primary"> filter</md-button>
  <md-button type="md-button" ng-click="toggleSortActive()" class="md-raised md-primary"> order</md-button>
  <md-button type="md-button" ng-click="selectAll()" class="md-raised md-primary"> <span ng-if="selectedAll">un</span>select all</md-button>
  <md-button type="md-button" ng-controller="MultiEditController" ng-click="open()" class="md-raised md-primary"> edit selected</md-button>
</div>
<!-- app/views/things.html end -->
